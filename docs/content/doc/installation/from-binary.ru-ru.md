---
date: "2017-06-19T12:00:00+02:00"
title: "Установка из двоичного файла"
slug: "install-from-binary"
weight: 10
toc: true
draft: false
menu:
  sidebar:
    parent: "installation"
    name: "Из двоичного файла"
    weight: 20
    identifier: "install-from-binary"
---

# Установка из двоичного файла

Все загрузки идут с поддержкой SQLite, MySQL и PostgreSQL и созданы с использованием
встроенных активов. Они могут отличаться от более старых выпусков. Выберите соответствующий файл
платформы назначения из [страницы скачивания](https://dl.gitea.io/gitea/), скопируйте
URL-адрес и замените URL-адрес в командах ниже:

```sh
wget -O gitea https://dl.gitea.io/gitea/{{< version >}}/gitea-{{< version >}}-linux-amd64
chmod +x gitea
```

## Проверить подпись GPG
Gitea подписывает все двоичные файлы [ключом GPG](https://keys.openpgp.org/search?q=teabot%40gitea.io) для предотвращения нежелательной модификации двоичных файлов. Чтобы проверить двоичный файл, загрузите файл подписи, который заканчивается на `.asc` для загруженного двоичного файла, и используйте инструмент командной строки gpg.

```sh
gpg --keyserver keys.openpgp.org --recv 7C9E68152594688862D62AF62D9AE806EC1592E2
gpg --verify gitea-{{< version >}}-linux-amd64.asc gitea-{{< version >}}-linux-amd64
```

## Рекомендуемая конфигурация сервера

**ПРИМЕЧАНИЕ:** Многие из следующих каталогов также можно настроить с помощью [Особые переменные]({{< relref "doc/advanced/specific-variables.ru-ru.md" >}})!
Следует отметить, что настройка `GITEA_WORK_DIR` сообщит Gitea, где разместить его рабочий каталог, а также упростит установку.

### Подготовка среды

Убедитесь, что на сервере установлен Git. Если это не так, сначала установите его.
```sh
git --version
```

Создайте пользователя для запуска Gitea (например, `git`)
```sh
adduser \
   --system \
   --shell /bin/bash \
   --gecos 'Git Version Control' \
   --group \
   --disabled-password \
   --home /home/git \
   git
```

### Создайте необходимую структуру каталогов

```sh
mkdir -p /var/lib/gitea/{custom,data,log}
chown -R git:git /var/lib/gitea/
chmod -R 750 /var/lib/gitea/
mkdir /etc/gitea
chown root:git /etc/gitea
chmod 770 /etc/gitea
```

**ПРИМЕЧАНИЕ:** `/etc/gitea` - временный набор с правами записи для пользователя `git`, чтобы веб-установщик мог записать файл конфигурации. После завершения установки рекомендуется установить права только для чтения с помощью:
```
chmod 750 /etc/gitea
chmod 640 /etc/gitea/app.ini
```
Если вы не хотите, чтобы веб-установщик вообще мог записывать файл конфигурации, также можно сделать файл конфигурации доступным только для чтения для пользователя gitea (владелец/группа `root:root`, режим `0660` ) и установите `INSTALL_LOCK = true`. В этом случае все детали конфигурации базы данных должны быть установлены заранее в файле конфигурации, а также значения `SECRET_KEY` и `INTERNAL_TOKEN`. Обратитесь к [документацию о командной строке]({{< relref "doc/usage/command-line.ru-ru.md" >}}) для информации об использовании `gitea generate secret INTERNAL_TOKEN`.

### Настроить рабочий каталог Gitea

**ПРИМЕЧАНИЕ:** Если вы планируете запускать Gitea как службу Linux, вы можете пропустить этот шаг, так как служебный файл позволяет вам установить `WorkingDirectory`. В противном случае подумайте о том, чтобы установить эту переменную среды (полу-)перманентным, чтобы Gitea постоянно использовала правильный рабочий каталог.
```
export GITEA_WORK_DIR=/var/lib/gitea/
```

### Скопируйте двоичный файл Gitea в глобальное местоположение

```
cp gitea /usr/local/bin/gitea
```

## Запуск Gitea

После описанных выше шагов два варианта запуска Gitea:

### 1. Создание служебного файла для автоматического запуска Gitea (рекомендуется)

Посмотрите, как создать [Linux service]({{< relref "run-as-service-in-ubuntu.ru-ru.md" >}})

### 2. Запуск из командной строки/терминала

```
GITEA_WORK_DIR=/var/lib/gitea/ /usr/local/bin/gitea web -c /etc/gitea/app.ini
```

## Обновление до новой версии

Вы можете выполнить обновление до новой версии Gitea, остановив Gitea, заменив двоичный файл в `/usr/local/bin/gitea` и перезапустив экземпляр.
Имя двоичного файла не следует изменять во время обновления, чтобы избежать проблем
в существующих репозиториях.

Рекомендуется сделать [резервное копирование и восстановление]({{< relref "doc/usage/backup-and-restore.ru-ru.md" >}}) перед обновлением вашей установки.

Если вы выполнили шаги установки, как описано выше, двоичный файл должен иметь общее
имя `gitea`. Не меняйте это значение, т.е. не добавляйте номер версии.

### 1. Перезапуск gitea с помощью systemd (рекомендуется)

Как объяснялось ранее, мы рекомендуем использовать systemd в качестве диспетчера служб. В этом случае будет достаточно ```systemctl restart gitea```.

### 2. Перезапуск gitea без systemd

Чтобы перезапустить экземпляр gitea, мы рекомендуем использовать сигнал SIGHUP. Если вы знаете, что ваш gitea PID использует ```kill -1 $GITEA_PID```, в противном случае вы можете использовать ```killall -1 gitea``` или ```pkill -1 gitea```

Для корректной остановки экземпляра gitea достаточно простого ```kill $GITEA_PID``` или ```killall gitea```.

**ПРИМЕЧАНИЕ:** Мы не рекомендуем использовать сигнал SIGKILL (известный также как `-9`), вы можете принудительно остановить некоторые внутренние задачи Gitea, и он не будет корректно останавливаться (задачи в очередях, процессы индексатора и т.д.)

См. Ниже инструкции по устранению неполадок для восстановления поврежденных
репозиториев после обновления вашей версии Gitea.

## Исправление проблем

### Старые версии glibc

Старые дистрибутивы Linux (такие как Debian 7 и CentOS 6) могут не иметь возможности загрузить
двоичный файл Gitea, что обычно приводит к ошибке типа ```./gitea:/lib/x86_64-linux-gnu/libc.so.6: version `GLIBC\_2.14' not found (required by ./gitea)```. Это связано с интегрированной поддержкой SQLite в двоичных файлах, предоставляемых dl.gitea.io. В этой ситуации обычно можно [установка с source]({{< relref "from-source.ru-ru.md" >}}) без поддержки
sqlite.

### Запуск Gitea на другом порту

Для ошибок типа `702 runWeb()] [E] Failed to start server: listen tcp 0.0.0.0:3000:
bind: address already in use` Gitea нужно запустить на другом свободном порту. Это
возможно с помощью `./gitea web -p $PORT`. Возможно, уже запущен другой экземпляр
Gitea.

### Запуск Gitea на Raspbian

Начиная с версии 1.8, существует проблема с версией Gitea для arm7, и она не работает на Raspberry Pi и подобных устройствах.

Поэтому рекомендуется перейти на версию arm6, которая была протестирована и доказала свою работоспособность на Raspberry Pi и аналогичных устройствах.

<!---
please remove after fixing the arm7 bug
--->
### Ошибка Git после обновления до новой версии Gitea

Если имя двоичного файла было изменено во время обновления до новой версии Gitea,
hook'и git в существующих репозиториях больше не будут работать. В этом случае
при отправке в репозиторий будет отображаться ошибка git.

```
remote: ./hooks/pre-receive.d/gitea: line 2: [...]: No such file or directory
```

Часть сообщения об ошибке `[...]` будет содержать путь к вашему предыдущему двоичному файлу 
Gitea.

Чтобы решить эту проблему, перейдите в параметры администратора и запустите задачу
`Resynchronize pre-receive, update and post-receive hooks of all repositories`, чтобы
обновить все hook'и, чтобы они содержали новый двоичный путь. Обратите внимание, что
при этом перезаписываются все hook'и git, включая те, которые были изменены.

Если вы не используете встроенный в Gitea SSH-сервер, вам также необходимо перезаписать
авторизованный ключевой файл, запустив `Обновите файл '.ssh/authorized_keys' с помощью
задачи Gitea SSH keys. В параметрах администратора.
