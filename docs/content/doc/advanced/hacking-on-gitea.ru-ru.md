---
date: "2016-12-01T16:00:00+02:00"
title: "Hacking on Gitea"
slug: "hacking-on-gitea"
weight: 10
toc: false
draft: false
menu:
  sidebar:
    parent: "advanced"
    name: "Hacking on Gitea"
    weight: 10
    identifier: "hacking-on-gitea"
---

# Hacking on Gitea

## Установка go

Вам следует [установить go](https://golang.org/doc/install) и правильно настроить
среду go.

Затем [установите Node.js с помощью npm] (https://nodejs.org/ru/download/), который
необходим для создания файлов JavaScript и CSS. Минимальная поддерживаемая версия
Node.js - {{<min-node-version>}}, и рекомендуется последняя версия LTS.

Вам также понадобится make.
<a href='{{< relref "doc/advanced/make.ru-ru.md" >}}'>(Смотрите здесь, как получить Make)</a>

**Примечание**: При выполнении задач make, требующих внешних инструментов,
таких как `make misspell-check`, Gitea автоматически загружает и создает
их по мере необходимости. Чтобы использовать их, у вас должен быть каталог
`"$GOPATH"/bin` на исполняемом пути. Если вы не добавите каталог go bin в
путь к исполняемому файлу, вам придется управлять этим самостоятельно.

**Примечание 2**: Требуется версия Go {{<min-go-version>}} или выше; однако важно отметить, что наша
непрерывная интеграция будет проверять, что форматирование исходного кода не изменяется с помощью
`gofmt` с помощью `make fmt-check`. К сожалению, результаты `gofmt` могут отличаться в зависимости
от версии `go`. Поэтому рекомендуется установить версию Go, с которой работает наша непрерывная интеграция.
На момент последнего обновления это должна быть версия Go {{<go-version>}}.

## Скачивание и клонирование исходного кода Gitea

Рекомендуемый метод получения исходного кода - использование `git clone`.

```bash
git clone https://github.com/go-gitea/gitea
```

(С появлением модулей go больше нет необходимости создавать проекты
go из `$GOPATH`, поэтому подход `go get` больше не рекомендуется.)

## Форк Gitea

Загрузите основной исходный код Gitea, как указано выше. Затем создайте
форк [репозитория Gitea] (https://github.com/go-gitea/gitea) на GitHub и
либо переключите удалённый источник git для своей вилки, либо добавьте
форк в качестве другого удалённого:

```bash
# Rename original Gitea origin to upstream
git remote rename origin upstream
git remote add origin "git@github.com:$GITHUB_USERNAME/gitea.git"
git fetch --all --prune
```

или:

```bash
# Add new remote for our fork
git remote add "$FORK_NAME" "git@github.com:$GITHUB_USERNAME/gitea.git"
git fetch --all --prune
```

Чтобы иметь возможность создавать pull request, разветвленный репозиторий
должен быть добавлен как удаленный к источникам Gitea. В противном случае изменения не будут внесены.

## Сборка Gitea (Basic)

Взгляните на наши
<a href='{{< relref "doc/installation/from-source.ru-ru.md" >}}'>инструкции</a>
для <a href='{{< relref "doc/installation/from-source.ru-ru.md" >}}'>сборки из
source</a>.

Самый простой рекомендуемый способ сборки из исходного кода:

```bash
TAGS="bindata sqlite sqlite_unlock_notify" make build
```

Цель `build` будет выполнять подцели и `frontend`, и `backend`. Если присутствует тег `bindata`, файлы внешнего интерфейса будут скомпилированы в двоичный файл. При разработке внешнего интерфейса рекомендуется не использовать этот тег, чтобы изменения были отражены.

Смотрите `make help` для всех доступных целей `make`. Также см. [`.drone.yml`](https://github.com/go-gitea/gitea/blob/master/.drone.yml) чтобы увидеть, как работает наша непрерывная интеграция.

## Строительство непрерывно

Запускать и непрерывно перестраивать при изменении исходных файлов:

````bash
make watch
````

В macOS просмотр всех исходных файлов серверной части может привести к превышению лимита открытых файлов по умолчанию, который можно увеличить с помощью `ulimit -n 12288` для текущей оболочки или в файле запуска вашей оболочки для всех будущих оболочек.

### Форматирование, анализ кода и проверка орфографии

Наша непрерывная интеграция будет отклонять PR, которые не отформатированы должным
образом, не позволяют анализ кода или проверку орфографии.

Вы должны отформатировать свой код с помощью `go fmt`, используя:

```bash
make fmt
```

и можете проверить, будут ли ваши изменения соответствовать результатам с:

```bash
make fmt-check # which runs make fmt internally
```

**Примечание**: Результаты go fmt зависят от текущей версии go. Вы должны запустить ту
же версию go, что и на сервере непрерывной интеграции, как указано выше. `make fmt-check`
будет только проверять, будет ли ваш `go` отформатироваться по-другому - это может
отличаться от версии сервера CI.

Вы должны запустить восстановление, проверку и проверку правописания кода с помощью:

```bash
make revive vet misspell-check
```

### Работа над JS и CSS

Либо используйте цель `watch-frontend`, упомянутую выше, либо просто создайте один раз:

```bash
make build && ./gitea
```

Перед коммитом убедитесь, что линтеры проходят:

```bash
make lint-frontend
```

Примечание. При работе с кодом внешнего интерфейса установите для параметра `USE_SERVICE_WORKER` значение `false` в файле `app.ini`, чтобы предотвратить нежелательное кэширование ресурсов интерфейса.

### Создание и добавление SVG

Иконки SVG создаются с использованием цели `make svg`, которая компилирует источники иконок, определенные в `build/generate-svg.js`, в выходной каталог `public/img/svg`. Пользовательские значки могут быть добавлены в каталог `web_src/svg`.

### Создание логотипа

Версии логотипа в формате PNG создаются из одного исходного файла SVG `assets/logo.svg` с использованием цели `make generate-images`. Для его запуска должны быть доступны Node.js и npm. Тот же процесс можно использовать для создания собственных логотипов PNG из исходного файла SVG. Можно удалить части логотипа SVG для сборки значка, добавив класс `detail-remove` к удаляемым узлам SVG.

### Обновление API

При создании новых маршрутов API или изменении существующих маршрутов API вы **ДОЛЖНЫ**
обновить и/или создать [Swagger](https://swagger.io/docs/specification/2-0/what-is-swagger/)
документацию для использования [go-swagger](https://goswagger.io/) комментариев.
Структура этих комментариев описана в [specification](https://goswagger.io/use/spec.html#annotation-syntax).
Если вам нужна дополнительная информация о структуре Swagger, вы можете посмотреть
[Документацию Swagger 2.0](https://swagger.io/docs/specification/2-0/basic-structure/)
или сравните с предыдущим PR, добавив новую конечную точку API, например [PR #5483](https://github.com/go-gitea/gitea/pull/5843/files#diff-2e0a7b644cf31e1c8ef7d76b444fe3aaR20)

Вы должны быть осторожны, чтобы не нарушить API для последующих пользователей,
которые зависят от стабильного API. В общем, это означает, что добавления приемлемы,
но удаления или фундаментальные изменения API будут отклонены.

После того, как вы создали или изменили конечную точку API, заново сгенерируйте
документацию Swagger, используя:

```bash
make generate-swagger
```

Вам следует проверить сгенерированный файл Swagger и проверить его правописание с помощью:

```bash
make swagger-validate misspell-check
```

Вы должны зафиксировать файл JSON изменения swagger. Сервер непрерывной интеграции
проверит, что это было сделано, используя:

```bash
make swagger-check
```

**Примечание**: Обратите внимание, что вам следует использовать документацию
Swagger 2.0, а не документацию OpenAPI 3.

### Создание новых параметров конфигурации

При создании новых параметров конфигурации недостаточно добавить их в файлы 
`modules/setting`. Вы должны добавить информацию в `custom/conf/app.ini` и в
<a href='{{< relref "doc/advanced/config-cheat-sheet.ru-ru.md" >}}'>памятке по конфигурации</a>,
которую можно найти в `docs/content/doc/advanced/config-cheat-sheet.ru-ru.md`

### Смена логотипа

При изменении SVG логотипа Gitea вам нужно будет запустить и зафиксировать
результаты:

```bash
make generate-images
```

Это создаст необходимый значок Gitea и другие.

### Миграция базы данных

Если вы вносите критические изменения в любую из сохраняемых структур базы
данных в каталоге `models/`, вам нужно будет выполнить новую миграцию. Их
можно найти в `models /migrations/`. Вы можете убедиться, что ваши миграции
работают для основных типов баз данных, используя:

```bash
make test-sqlite-migration # with sqlite switched for the appropriate database
```

## Тестирование

Gitea выполняет два типа тестов: модульные тесты и интеграционные тесты.

```bash
TAGS="bindata sqlite sqlite_unlock_notify" make test # Runs the unit tests
```

Модульные тесты не могут и не могут полностью протестировать Gitea в одиночку.
Поэтому мы написали интеграционные тесты; однако они зависят от базы данных.

```bash
TAGS="bindata sqlite sqlite_unlock_notify" make build test-sqlite
```

запустит интеграционные тесты в среде sqlite. Для интеграционных тестов
требуется установка `git lfs`. Доступны и другие тесты базы данных, но,
возможно, потребуется адаптация к локальной среде.

Обратитесь к
[`integrations/README.md`](https://github.com/go-gitea/gitea/blob/master/integrations/README.md)
для получения дополнительной информации и о том, как запустить одиночный тест.

Наша непрерывная интеграция проверит, что код проходит свои модульные тесты
и что все поддерживаемые базы данных пройдут интеграционный тест в среде Docker.
Также будет протестирован переход с нескольких последних версий Gitea.

Пожалуйста, отправьте свой PR с дополнительными тестами и интеграционными тестами как
подходящее.

## Документация для сайта

Документация для веб-сайта находится в `docs/`. Если вы измените это, вы
можете протестировать свои изменения, чтобы убедиться, что они проходят
непрерывную интеграцию, используя:

```bash
# from the docs directory within Gitea
make trans-copy clean build
```

Для выполнения этой задачи вам потребуется копия [Hugo] (https://gohugo.io/).
Обратите внимание: это может привести к появлению ряда неотслеживаемых
объектов git, которые необходимо очистить.

## Visual Studio Code

Файлы `launch.json` и `tasks.json` предоставляются в `contrib/ide/vscode` для
Visual Studio Code. Обратитесь к
[`contrib/ide/README.md`](https://github.com/go-gitea/gitea/blob/master/contrib/ide/README.md)
чтобы получить больше информации.

## Отправка PR

Когда вы будете довольны своими изменениями, подтолкните их и откройте pull request.
Рекомендуется разрешить менеджерам и владельцам Gitea изменять ваши PR-ветки, так как
нам нужно будет обновить их до master перед объединением и/или мы сможем помочь
исправить проблемы напрямую.

Любой PR требует двух одобрений от разработчиков Gitlab и должен пройти
непрерывную интеграцию. Взгляните на наш документ
[`CONTRIBUTING.md`](https://github.com/go-gitea/gitea/blob/master/CONTRIBUTING.md)

Если вам нужна дополнительная помощь, обращайтесь в [Discord](https://discord.gg/gitea) #Develop
и обшайтесь там.

Вот оно! Вы готовы к Hacking'у on Gitea.
