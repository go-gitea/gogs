---
date: "2019-08-17T10:20:00+01:00"
title: "Подписи коммитов GPG"
slug: "signing"
weight: 20
toc: false
draft: false
menu:
  sidebar:
    parent: "advanced"
    name: "Подписи коммитов GPG"
    weight: 20
    identifier: "signing"
---

# Подписи коммитов GPG

Gitea проверит подписи коммитов GPG в предоставленном дереве,
проверив, подписаны ли коммиты ключом в базе данных gitea или
совпадает ли фиксация с ключом по умолчанию для git.

Ключи не проверяются, чтобы определить, срок их действия истек или они отозваны.
Ключи также не проверяются на серверах.

Фиксация будет отмечена серым значком разблокировки, если не может
быть найден ключ для ее проверки. Если фиксация отмечена красным
значком разблокировки, сообщается, что она подписана ключом с идентификатором.

Обратите внимание: лицо, подписывающее коммит, не обязательно должно быть автором или
коммитером, совершивший комммит.

Для этой функции требуется git >= 1.7.9, но для полной функциональности
требуется git >= 2.0.0.

## Автоматическая подпись

Есть несколько мест, где Gitea сама генерирует коммиты:

* Инициализация репозитория
* Изменения в вики
* Действия CRUD с использованием редактора или API
* Слияние из pull request'ов

В зависимости от конфигурации и доверия к серверу вы можете захотеть,
чтобы Gitea подписала эти коммиты.

## Установка и генерация ключа GPG для Gitea

Администратор сервера должен определить, как лучше всего установить
ключ подписи. Gitea в настоящее время генерирует все свои коммиты,
используя команду server `git`, поэтому для подписи будет использоваться
сервер`gpg` (если он настроен). Администраторы должны ознакомиться с
передовыми практиками для gpg - в частности, вероятно, рекомендуется
только установить секретный подключ подписи без главного подписывающего
и удостоверяющего секретного ключа.

## Общая конфигурация

Конфигурацию Gitea для подписи можно найти в разделе
`[repository.signing]` в `app.ini`:

```ini
...
[repository.signing]
SIGNING_KEY = default
SIGNING_NAME =
SIGNING_EMAIL =
INITIAL_COMMIT = always
CRUD_ACTIONS = pubkey, twofa, parentsigned
WIKI = never
MERGES = pubkey, twofa, basesigned, commitssigned

...
```

### `SIGNING_KEY`

Первый вариант, который следует обсудить, - это `SIGNING_KEY`. Есть три основных
варианта:

* `none` - это не позволяет Gitea подписывать какие-либо коммиты
* `default` - Gitea по умолчанию будет использовать ключ, настроенный в
`git config`
* `KEYID` - Gitea подпишет коммиты ключом gpg с идентификатором
`KEYID`. В этом случае вы должны предоставить `SIGNING_NAME` b
`SIGNING_EMAIL` для отображения для этого ключа.

Параметр `default` будет запрашивать` git config` для
параметра `commit.gpgsign` - если он установлен, то он
будет использовать результаты`user.signingkey`,
`user.name` и`user.email` как подходящее.

Обратите внимание: при настройке git-файла `config` в репозиториях
Gitea,`SIGNING_KEY=default` можно использовать для предоставления
разных ключей подписи для каждого репозитория. Однако это явно не
идеальный пользовательский интерфейс и поэтому может быть изменен.

### `INITIAL_COMMIT`

Этот параметр определяет, должен ли Gitea подписывать первоначальный коммит
при создании репозитория. Возможные значения:

* `never`: Никогда не подписывать
* `pubkey`: Подпишите, только если у пользователя есть открытый ключ
* `twofa`: Подпишите, только если пользователь входит в систему с двухфакторной аутентификацией
* `always`: Всегда подписывать

Опции, отличные от never и always, могут быть объединены в список,
разделенный запятыми.

### `WIKI`

Эта опция определяет, должен ли Gitea подписывать коммиты на Вики.
Возможные значения:

* `never`: Никогда не подписывать
* `pubkey`: Подпишите, только если у пользователя есть открытый ключ
* `twofa`: Подпишите, только если пользователь входит в систему с двухфакторной аутентификацией
* `parentsigned`: Подпишите, только если подписан родительский коммит.
* `always`: Всегда подписывать

Опции, отличные от `never` и `always`, могут быть объединены в список,
разделенный запятыми.

### `CRUD_ACTIONS`

Этот параметр определяет, должен ли Gitea подписывать коммиты из
веб-редактора или действия API CRUD. Возможные значения:

* `never`: Никогда не подписывать
* `pubkey`: Подпишите, только если у пользователя есть открытый ключ
* `twofa`: Подпишите, только если пользователь входит в систему с двухфакторной аутентификацией
* `parentsigned`: Подпишите, только если подписан родительский коммит.
* `always`: Всегда подписывать

Опции, отличные от `never` и `always`, могут быть объединены в список,
разделенный запятыми.

### `MERGES`

Этот параметр определяет, должен ли Gitea подписывать коммиты слияния из PR.
Возможные варианты:

* `never`: Никогда не подписывать
* `pubkey`: Подпишите, только если у пользователя есть открытый ключ
* `twofa`: Подпишите, только если пользователь входит в систему с двухфакторной аутентификацией
* `basesigned`: Подпишите, только если родительский коммит в базовом репо подписан.
* `headsigned`: Подпишите, только если подписана главный коммит в головной ветви.
* `commitssigned`: Подпишите, только если подписаны все коммиты в головной ветви до точки слияния.
* `approved`: Подписывайте только утвержденные слияния с защищённой веткой.
* `always`: Всегда подписывать

Опции, отличные от `never` и `always`, могут быть объединены в список,
разделенный запятыми.

## Получение открытого ключа подписывающего ключа

Открытый ключ, используемый для подписи коммитов Gitea, можно получить из API по адресу:

```
/api/v1/signing-key.gpg
```

В случаях, когда есть специальный ключ репозитория, его можно получить из:

```
/api/v1/repos/:username/:reponame/signing-key.gpg
```
