[English](CONTRIBUTING.md)

# Правила соучастников

## Оглавление

- [Правила соучастников](#правила-соучастников)
  - [Введение](#введение)
  - [Сообщить об ошибках](#сообщить-об-ошибках)
  - [Обсуждение дизайна](#обсуждение-дизайна)
  - [Тестирование](#тестирование)
  - [Vendoring](#vendoring)
  - [Перевод](#перевод)
  - [Обзор кода](#обзор-кода)
  - [Руководство по редактированию](#руководство-по-редактированию)
  - [Рекомендации по дизайну](#рекомендации-по-дизайну)
  - [API v1](#api-v1)
  - [Developer Certificate of Origin (DCO)](#developer-certificate-of-origin-dco)
  - [Цикл релиза](#цикл-релиза)
  - [Сопровождающие](#сопровождающие)
  - [Владельцы](#владельцы)
  - [Версии](#версии)
  - [Релиз Gitea](#релиз-gitea)
  - [Авторские права](#авторские-права)

## Введение

В этом документе объясняется, как внести изменения в проект Gitea.
Предполагается, что вы следовали
[Установке](https://docs.gitea.io/ru-ru/installation/).
О чувствительных проблемах, связанных с безопасностью, следует сообщать
[security@gitea.io](mailto:security@gitea.io).

Для настройки IDE или редактора кода для разработки Gitea см. [Конфигурация IDE и редактора кода](contrib/ide/)

## Сообщить об ошибках

Выполните поиск проблем в системе отслеживания проблем, используя различные
ключевые слова, чтобы убедиться, что о вашей ошибке ещё не сообщалось.

Если новая, [откройте issue](https://github.com/go-gitea/gitea/issues/new)
(напишите его **НА АНГЛИЙСКОМ ЯЗЫКЕ**) и ответим на вопросы, чтобы мы могли
понять и воспроизвести проблемное поведение.

Чтобы показать нам, что проблема, с которой вы столкнулись, связана
с самой Gitea, напишите чёткие и краткие инструкции, чтобы мы могли
воспроизвести поведение, даже если оно кажется очевидным. Чем подробнее
и конкретнее вы укажете, тем быстрее мы сможем решить проблему.
Ознакомьтесь с [Как эффективно сообщать об ошибках](http://www.chiark.greenend.org.uk/~sgtatham/bugs.html).

Пожалуйста, будьте добры, помните, что Gitea предоставляется вам бесплатно,
и вы получаете бесплатную помощь.

## Обсуждение дизайна

Проект приветствует заявки. Если вы хотите что-то изменить или добавить,
сообщите всем, над чем вы работаете - [подайте issue](https://github.com/go-gitea/gitea/issues/new)!
Существенные изменения должны пройти процесс предложения по изменению,
прежде чем они могут быть приняты. Чтобы создать предложение, запишите
проблему с задокументированными предлагаемыми изменениями и отметьте
в названии проблемы, что это предложение.

Этот процесс дает каждому возможность проверить дизайн, помогает
предотвратить дублирование усилий и гарантирует, что идея соответствует
целям проекта и инструментам. Он также проверяет правильность дизайна
перед написанием кода; инструмент проверки кода - не место для
обсуждений на высоком уровне.

## Тестирование

Перед отправкой запроса на перенос выполните все тесты для всего дерева,
чтобы убедиться, что ваши изменения не вызывают регрессии где-либо ещё.

Вот как запустить набор тестов:

- code lint

|                       |                                                                   |
| :-------------------- | :---------------------------------------------------------------- |
|``make lint``          | lint всего (не рекомендуется, если вы меняете только один код типа) |
|``make lint-frontend`` | файлы внешнего интерфейса lint |
|``make lint-backend``  | файлы заднего интерфейса lint |

- запустить тестовый код (предложить запустить в Linux)

|                                        |                                                  |
| :------------------------------------- | :----------------------------------------------- |
|``make test[\#TestSpecificName]``       |  запустить модульный тест  |
|``make test-sqlite[\#TestSpecificName]``|  запустить тест [интеграции](интеграции) для sqlite |  
|[Более подробное сообщение об интеграции](integrations/README_RU.md)  |

## Vendoring

Мы храним кешированную копию зависимостей в каталоге `vendor/`, управляя
обновлениями через [Modules](https://golang.org/cmd/go/#hdr-Module_maintenance).

Pull request'ы должны включать обновления `vendor/`, только если
они являются частью одного и того же изменения, будь то исправление ошибки или добавление функции.

Обновление `vendor/` должно быть обосновано как часть описания PR и должно
быть проверено рецензентами и/или слиянием, чтобы всегда ссылаться на
существующий коммит восходящего потока.

Вы можете найти дополнительную информацию о том, как начать работу с ним на [Вики по Modules](https://github.com/golang/go/wiki/Modules).

## Перевод

Все переводческие работы делаем внутри [Crowdin](https://crowdin.com/project/gitea).
Единственный перевод, который поддерживается в этом репозитории git, - это
[`en_US.ini`](https://github.com/go-gitea/gitea/blob/master/options/locale/locale_en-US.ini)
и регулярно синхронизируется с Crowdin. Как только перевод достигнет
УДОВЛЕТВОРИТЕЛЬНОГО ПРОЦЕНТА, он будет снова синхронизирован с этим
репо и включен в следующую выпущенную версию.

## Сборка Gitea

См. [Инструкции по взлому](https://docs.gitea.io/en-us/hacking-on-gitea/).

## Обзор кода

Изменения в Gitea должны быть проверены перед их принятием - независимо
от того, кто вносит изменения, даже если они являются владельцем или
сопровождающим. Для этого мы используем рабочий процесс pull request'а GitHub.
И мы также используем [LGTM](http://lgtm.co), чтобы гарантировать, что каждый
PR проверяется как минимум двумя сопровождающими.

Пожалуйста, постарайтесь упростить для нас рассмотрение вашего запроса на перенос. И, пожалуйста, прочтите
руководство *[Как получить более быстрые PR-обзоры](https://github.com/kubernetes/community/blob/261cb0fd089b64002c91e8eddceebf032462ccd6/contributors/guide/pull-requests.md#best-practices-for-faster-reviews)* ;
в нём есть много полезных советов для любого проекта, в который вы хотите внести свой вклад.
Некоторые ключевые моменты:

* Делайте небольшие pull request'ы. Чем меньше, тем быстрее будет
  проверка и тем больше вероятность, что она скоро будет объединена.
* Не вносите изменений, не связанных с вашим PR. Может быть, в некоторых
  комментариях есть опечатки, возможно, рефакторинг функции будет
  приветствоваться... но если это не связано с вашим PR, сделайте *ещё* PR для этого.
* Разделите большие pull request'ы нескольких мелких. Постепенное
  изменение будет быстрее проанализировать, чем огромный PR.

## Руководство по редактированию

Для импорта вы должны использовать следующий формат (_без_ комментариев)
```go
import (
  // stdlib
  "encoding/json"
  "fmt"

  // local packages
  "code.gitea.io/gitea/models"
  "code.gitea.io/sdk/gitea"

  // external packages
  "github.com/foo/bar"
  "gopkg.io/baz.v1"
)
```

## Рекомендации по структуре

Чтобы поддерживать понятный код и избегать циклических зависимостей, важно иметь хорошую структуру кода. Код gitea разделён на следующие части:

- **integration:** Интеграционные тесты
- **models:** Содержит структуры данных, используемые xorm для создания таблиц базы данных. Он также содержит вспомогательные функции для запроса и обновления базы данных. Следует избегать зависимости от другого кода в Gitea, хотя могут потребоваться некоторые модули (например, для ведения журнала).
- **models/fixtures:** Пример данных модели, используемых в интеграционных тестах.
- **models/migrations:** Обработка миграции базы данных между версиями. PR, которые изменяют структуру базы данных, также должны иметь этап миграции.
- **modules:** Различные модули для обработки определённых функций в Gitea.
- **public:** Файлы внешнего интерфейса (javascript, изображения, css и т.д.)
- **routers:** Обработка запросов к серверу. Поскольку он использует другие пакеты Gitea для обслуживания запроса, другие пакеты (модели, модули или службы) не должны зависеть от маршрутизаторов.
- **services:** Функции поддержки для общих операций маршрутизации. Использует модели и модули для обработки запроса.
- **templates:** Шаблоны Golang для генерации вывода html.
- **vendor:** Внешний код, от которого зависит Gitea.

## API v1

API документирован [swagger](http://try.gitea.io/api/swagger) и основан на [GitHub API v3](https://developer.github.com/v3/).
Таким образом, API Gitea должен использовать те же конечные точки и поля, что и API GitHub, насколько это возможно, если нет веских причин для отклонения. 
Если Gitea предоставляет функции, которых нет в GitHub, можно создать новую конечную точку.  
Если Gitea предоставляет информацию, которая не предоставляется GitHub API, можно использовать новое поле, которое не конфликтует ни с одним из полей GitHub.

Обновление существующего API не должно удалять существующие поля, если для этого нет действительно веской причины.
То же самое и с ответами о статусе. Если вы заметили проблему, не стесняйтесь оставлять комментарий в коде для будущего рефакторинга APIv2 (который в настоящее время не планируется).

Все ожидаемые результаты (ошибки, успехи, сообщения об ошибках) должны быть задокументированы.
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/routers/api/v1/repo/issue.go#L319-L327)).

Все типы ввода JSON должны быть определены как структура в `models/structs/`
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/modules/structs/issue.go#L76-L91))
и упоминается в
[routers/api/v1/swagger/options.go](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/routers/api/v1/swagger/options.go).  
Затем их можно использовать следующим образом:
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/routers/api/v1/repo/issue.go#L318)).

Все ответы JSON должны быть определены как структура в `models/structs/`
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/modules/structs/issue.go#L36-L68))
и упоминается в своей категории в `routers/api/v1/swagger/`
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/routers/api/v1/swagger/issue.go#L11-L16))  
Их можно использовать следующим образом:
([пример](https://github.com/go-gitea/gitea/blob/c620eb5b2d0d874da68ebd734d3864c5224f71f7/routers/api/v1/repo/issue.go#L277-L279))

Обычно методы HTTP выбираются следующим образом:
 * **GET** конечные точки возвращают запрошенный объект и статус **OK (200)**
 * **DELETE** конечные точки возвращают статус **No Content (204)**
 * **POST** конечные точки возвращают статус **Created (201)**, используется для **создания** новых объектов (например, пользователя)
 * **PUT** конечные точки возвращают статус **No Content (204)**, используется для **добавления/назначения** существующих объектов (например, пользователя) чему-либо (например, орг-команды)
 * **PATCH** конечные точки возвращают изменённый объект и статус **OK (200)**, используется для **редактирования/изменения** существующего объекта


Конечная точка, которая изменяет/редактирует объект, ожидает, что все поля будут необязательными (кроме тех, которые идентифицируют объект, которые являются обязательными).


## Developer Certificate of Origin (DCO)

Мы рассматриваем внесение вклада в код путём отправки pull request'а
как "подписаный" или согласие с сертификатами и условиями [DCO](DCO)
и [MIT license](LICENSE). Никаких дополнительных действий не требуется.
Кроме того, вы можете добавить строку в конце сообщения о коммите.

```
Signed-off-by: Joe Smith <joe.smith@email.com>
```

Если вы установите git-конфигурации `user.name` и `user.email`, вы можете
автоматически добавить строку в конец коммита с помощью `git commit -s`.

Мы добросовестно предполагаем, что предоставленная вами информация является юридически обязательной.

## Цикл релиза

Мы приняли график релизов, чтобы упростить процесс работы, завершения
и релиза релизов. Общая цель - выпускать второстепенный релиз каждые
два месяца, который разбивается на один месяц общей разработки, за которым
следует один месяц тестирования и доработки, известного как замораживание
релиза. Все pull request'ы должны быть объединены в первый месяц одного периода релиза.
Во время замороженного периода соответствующая ветвь релиза открыта для исправлений,
перенесённых из мастера. Кандидаты на релиз создаются в течение этого периода для
пользовательского тестирования, чтобы получить окончательную версию, которая поддерживается
в этой ветви. Релиз поддерживается выпуском патчей, исправляющих только критические проблемы,
такие как сбои или проблемы с безопасностью.

Основные циклы релиза - раз в два месяца. Они всегда начинаются 25-го и
заканчиваются 24-го (то есть с 25 декабря по 24 февраля).

Во время цикла разработки мы также можем публиковать любые необходимые второстепенные
релизы предыдущей версии. Например, если последний опубликованный выпуск - v1.2, то
незначительные изменения для предыдущего релиза - например, v1.1.0 -> v1.1.1 - всё ещё возможны.

## Сопровождающие

Чтобы убедиться, что каждый PR проверяется, у нас
есть [специалисты по сопровождению](MAINTAINERS). Каждый PR **ДОЛЖЕН**
быть рассмотрен как минимум двумя сопровождающими (или владельцами),
прежде чем он может быть объединен. Сопровождающий должен быть соавтором
Gitea (или Gogs) и сделал не менее 4 принятых PR. Участник должен
подать заявку в качестве сопровождающего в
[Discord](https://discord.gg/NsatcWJ) в канале #develop. Владельцы
или сопровождающие команды могут пригласить участника. Сопровождающий
должен потратить некоторое время на проверку кода. Если у сопровождающего
нет времени на это, он должен подать заявление о выходе из команды
сопровождающих, и мы удостоим их чести быть членом [команды
консультантов](https://github.com/orgs/go-gitea/teams/advisors). Конечно,
если у консультанта есть время на проверку кода, мы будем рады
снова поприветствовать его в команде разработчиков. Если сопровождающий
неактивен более 3 месяцев и забывает покинуть команду сопровождающих,
владельцы могут перевести его или её из группы сопровождающих в команду
консультантов. По соображениям безопасности, сопровождающие должны
использовать 2ФА для своих учётных записей и, если возможно, предоставлять
подписанные gpg коммиты.
https://help.github.com/articles/securing-your-account-with-two-factor-authentication-2fa/
https://help.github.com/articles/signing-commits-with-gpg/

## Владельцы

Поскольку Gitea - это чисто общественная организация без какой-либо поддержки
со стороны компании, для поддержания здорового развития мы будем выбирать трёх
владельцев каждый год. Все участники могут проголосовать за избрание до трёх
кандидатов, один из которых будет основным владельцем, а два других - помощниками
владельцев. Когда будут избраны новые владельцы, старые владельцы уступят право
собственности вновь избранным. Если владелец не может этого сделать, другие
собственники помогут передать право собственности вновь избранным владельцам.
По соображениям безопасности владельцы или любая учётная запись с доступом
на запись (например, бот) должны использовать 2ФА.
https://help.github.com/articles/securing-your-account-with-two-factor-authentication-2fa/

После выборов новые владельцы должны заранее согласовать
с нашими требованиями [ВКЛАДА](CONTRIBUTING.md) в
[Discord](https://discord.gg/NsatcWJ) в канале #general. Ниже приведены слова,
которые нужно сказать:

```
I'm honored to having been elected an owner of Gitea, I agree with
[CONTRIBUTING](CONTRIBUTING.md). I will spend part of my time on Gitea
and lead the development of Gitea.
```

Чтобы почтить память прошлых владельцев, вот история владельцев и время,
в течение которого они служили:

* 2020-01-01 ~ 2020-12-31 - https://github.com/go-gitea/gitea/issues/9230
  * [Lunny Xiao](https://gitea.com/lunny) <xiaolunwen@gmail.com>
  * [Lauris Bukšis-Haberkorns](https://gitea.com/lafriks) <lauris@nix.lv>
  * [Matti Ranta](https://gitea.com/techknowlogick) <techknowlogick@gitea.io>

* 2019-01-01 ~ 2019-12-31 - https://github.com/go-gitea/gitea/issues/5572
  * [Lunny Xiao](https://github.com/lunny) <xiaolunwen@gmail.com>
  * [Lauris Bukšis-Haberkorns](https://github.com/lafriks) <lauris@nix.lv>
  * [Matti Ranta](https://github.com/techknowlogick) <techknowlogick@gitea.io>

* 2018-01-01 ~ 2018-12-31 - https://github.com/go-gitea/gitea/issues/3255
  * [Lunny Xiao](https://github.com/lunny) <xiaolunwen@gmail.com>
  * [Lauris Bukšis-Haberkorns](https://github.com/lafriks) <lauris@nix.lv>
  * [Kim Carlbäcker](https://github.com/bkcsoft) <kim.carlbacker@gmail.com>

* 2016-11-04 ~ 2017-12-31
  * [Lunny Xiao](https://github.com/lunny) <xiaolunwen@gmail.com>
  * [Thomas Boerger](https://github.com/tboerger) <thomas@webhippie.de>
  * [Kim Carlbäcker](https://github.com/bkcsoft) <kim.carlbacker@gmail.com>

## Версии

В Gitea есть ветка `master` в качестве ответвления и есть ветки версий,
такие как `release/v0.9`. `release/v0.9` - это ветвь выпуска, и мы будем
отмечать `v0.9.0` для двоичной загрузки. Если в `v0.9.0` есть ошибки, мы
будем принимать pull request'ы в ветке `release/v0.9` и опубликуем тег
`v0.9.1` после внесения исправления ошибки также в основную ветку.

Поскольку ветка `master` является подсказкой, если вы хотите использовать
Gitea в производстве, загрузите последнюю версию тега выпуска. Все ветки
будут защищены через GitHub, все PR для каждой ветки должны быть проверены
двумя сопровождающими и должны пройти автоматические тесты.

## Релиз Gitea

* Пусть $vmaj, $vmin и $vpat будут номерами версий Major, Minor и Patch, $vpat должно быть rc1, rc2, 0, 1, ...... $vmaj. $vmin будет оставаться таким же, как метки на github или gitea в будущем.
* Перед выпуском убедитесь, что все основные проблемы версии или PR были решены. Затем обсудите релиз на разнородном канале #maintainers и договоритесь практически со всеми собственниками и слияниями. Или вы можете объявить свою версию и, если никто не против, в течение примерно нескольких часов.
* Если это большая версия, сначала вам нужно создать PR для журнала изменений в ветке `master` с PR с меткой `changelog`, и после того, как она будет объединена, выполните следующие шаги:
  * Создайте тег `-dev` как `git tag -s -F release.notes v$vmaj.$vmin.0-dev` и вставьте тег как `git push origin v$vmaj.$vmin.0-dev`.
  * Когда CI завершит создание тега, вам нужно создать новую ветку с именем `release/v$vmaj.$vmin`
* Если это версия с исправлением ошибок, создайте PR для журнала изменений в ветке `release/v$vmaj. $vmin` и подождите, пока он будет рассмотрен и объединён.
* Добавьте тег как `git tag -s -F release.notes v$vmaj.$vmin.$`, Файл release.notes может быть временным файлом, чтобы включать только журнал изменений этой версии, который вы добавили в `CHANGELOG.md`.
* А затем вставьте тег как `git push origin v$vmaj.$vmin.$`. Drone CI автоматически создаст релиз и загрузит весь скомпилированный двоичный файл. (Но в настоящее время он не добавляет примечания к выпуску автоматически. Возможно, нам стоит это исправить.)
* Если необходимо, отправьте PR для журнала изменений в ветке `master` этой версии, которую вы добавили в `CHANGELOG.md`.
* Отправьте PR в [репозиторий блога](https://gitea.com/gitea/blog), объявив о выпуске.

## Авторские права

Код, который вы публикуете, должен использовать стандартный заголовок авторского права:

```
// Copyright 2020 The Gitea Authors. All rights reserved.
// Use of this source code is governed by a MIT-style
// license that can be found in the LICENSE file.
```

Файлы в репозитории содержат авторские права с года их добавления до года
последнего изменения. Если автор авторских прав изменился, просто вставьте
заголовок под старым.
